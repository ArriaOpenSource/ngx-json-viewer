{"version":3,"sources":["../../src/ngx-json-viewer/ngx-json-viewer.component.ts","../../src/ngx-json-viewer.module.ts"],"names":["NgxJsonViewerComponent","this","expanded","depth","restoreExpanded","showTypeHeadings","_currentDepth","segments","prototype","getOpenKeysRecursive","openKeys","childrenComponents","forEach","component","_key","Object","keys","length","openSegments","_this","_previouslyOpenKeys","key","foundSegment","find","segment","isExpandable","ngOnChanges","json","decycle","push","parseKeyValue","type","toggle","value","undefined","description","isExpanded","Array","isArray","JSON","stringify","Date","object","objects","WeakMap","derez","path","oldPath","nu","Boolean","Number","RegExp","String","get","$ref","set","element","i","name","Component","args","selector","template","Input","ViewChildren","NgModule","imports","CommonModule","declarations","exports"],"mappings":"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","sourcesContent":["import {Component, OnChanges, Input, ViewChildren, QueryList} from '@angular/core';\r\n\r\nexport interface ISegment {\r\n  key: string;\r\n  value: any;\r\n  type: undefined | string;\r\n  description: string;\r\n  expanded: boolean;\r\n}\r\n\r\n@Component({\r\n  selector: 'ngx-json-viewer',\r\n  templateUrl: './ngx-json-viewer.component.html',\r\n  styleUrls: ['./ngx-json-viewer.component.scss'],\r\n})\r\nexport class NgxJsonViewerComponent implements OnChanges {\r\n  @Input() public json: any;\r\n  @Input() public expanded = true;\r\n  @Input() public depth = -1;\r\n  @Input() public restoreExpanded = false;\r\n  @Input() public showTypeHeadings = false;\r\n\r\n  @Input() public _key: string;\r\n  @Input() public _previouslyOpenKeys?: {[key: string]: any};\r\n  @Input() public _currentDepth = -1;\r\n\r\n  public segments: ISegment[] = [];\r\n\r\n  @ViewChildren(NgxJsonViewerComponent)\r\n  public childrenComponents: QueryList<NgxJsonViewerComponent>;\r\n\r\n  private getOpenKeysRecursive(): any {\r\n    const openKeys: {[key: string]: any} = {};\r\n    this.childrenComponents.forEach((component) => {\r\n      // Save key and length\r\n      openKeys[component._key] = component.getOpenKeysRecursive();\r\n    });\r\n\r\n    if (Object.keys(openKeys).length === 0) {\r\n      return;\r\n    }\r\n    return openKeys;\r\n  }\r\n\r\n  private openSegments(): void {\r\n    const keys = Object.keys(this._previouslyOpenKeys!);\r\n    keys.forEach((key) => {\r\n      // Check to see if the key exists, if so expands it\r\n      const foundSegment = this.segments.find((segment) => segment.key === key);\r\n\r\n      if (!foundSegment) {\r\n        return;\r\n      }\r\n\r\n      if (!this.isExpandable(foundSegment)) {\r\n        return;\r\n      }\r\n\r\n      foundSegment.expanded = true;\r\n    });\r\n  }\r\n\r\n  public ngOnChanges(): void {\r\n    // Save open keys structure before processing new json\r\n    // Will only run in top level\r\n    if (this.restoreExpanded && this.childrenComponents) {\r\n      this._previouslyOpenKeys = this.getOpenKeysRecursive();\r\n    }\r\n\r\n    this.segments = [];\r\n\r\n    // remove cycles\r\n    this.json = this.decycle(this.json);\r\n\r\n    this._currentDepth++;\r\n\r\n    if (typeof this.json === 'object') {\r\n      Object.keys(this.json).forEach((key) => {\r\n        this.segments.push(this.parseKeyValue(key, this.json[key]));\r\n      });\r\n    } else {\r\n      this.segments.push(this.parseKeyValue(`(${typeof this.json})`, this.json));\r\n    }\r\n\r\n    if (!this._previouslyOpenKeys) {\r\n      return;\r\n    } else {\r\n      this.openSegments();\r\n    }\r\n  }\r\n\r\n  public isExpandable(segment: ISegment): any {\r\n    return segment.type === 'object' || segment.type === 'array';\r\n  }\r\n\r\n  public toggle(segment: ISegment): any {\r\n    if (this.isExpandable(segment)) {\r\n      segment.expanded = !segment.expanded;\r\n    }\r\n  }\r\n\r\n  private parseKeyValue(key: any, value: any): ISegment {\r\n    const segment: ISegment = {\r\n      key: key,\r\n      value: value,\r\n      type: undefined,\r\n      description: '' + value,\r\n      expanded: this.isExpanded(),\r\n    };\r\n\r\n    switch (typeof segment.value) {\r\n      case 'number': {\r\n        segment.type = 'number';\r\n        break;\r\n      }\r\n      case 'boolean': {\r\n        segment.type = 'boolean';\r\n        break;\r\n      }\r\n      case 'function': {\r\n        segment.type = 'function';\r\n        break;\r\n      }\r\n      case 'string': {\r\n        segment.type = 'string';\r\n        segment.description = '\"' + segment.value + '\"';\r\n        break;\r\n      }\r\n      case 'undefined': {\r\n        segment.type = 'undefined';\r\n        segment.description = 'undefined';\r\n        break;\r\n      }\r\n      case 'object': {\r\n        // yea, null is object\r\n        if (segment.value === null) {\r\n          segment.type = 'null';\r\n          segment.description = 'null';\r\n        } else if (Array.isArray(segment.value)) {\r\n          segment.type = 'array';\r\n          segment.description =\r\n            'Array[' + segment.value.length + '] ' + JSON.stringify(segment.value);\r\n        } else if (segment.value instanceof Date) {\r\n          segment.type = 'date';\r\n        } else {\r\n          segment.type = 'object';\r\n          segment.description = 'Object ' + JSON.stringify(segment.value);\r\n        }\r\n        break;\r\n      }\r\n    }\r\n\r\n    return segment;\r\n  }\r\n\r\n  private isExpanded(): boolean {\r\n    return this.expanded && !(this.depth > -1 && this._currentDepth >= this.depth);\r\n  }\r\n\r\n  // https://github.com/douglascrockford/JSON-js/blob/master/cycle.js\r\n  private decycle(object: any): any {\r\n    const objects = new WeakMap();\r\n    return (function derez(value: any, path: any): any {\r\n      let oldPath;\r\n      let nu: any;\r\n\r\n      if (\r\n        typeof value === 'object' &&\r\n        value !== null &&\r\n        !(value instanceof Boolean) &&\r\n        !(value instanceof Date) &&\r\n        !(value instanceof Number) &&\r\n        !(value instanceof RegExp) &&\r\n        !(value instanceof String)\r\n      ) {\r\n        oldPath = objects.get(value);\r\n        if (oldPath !== undefined) {\r\n          return {$ref: oldPath};\r\n        }\r\n        objects.set(value, path);\r\n\r\n        if (Array.isArray(value)) {\r\n          nu = [];\r\n          value.forEach((element, i) => {\r\n            nu[i] = derez(element, path + '[' + i + ']');\r\n          });\r\n        } else {\r\n          nu = {};\r\n          Object.keys(value).forEach((name) => {\r\n            nu[name] = derez(value[name], path + '[' + JSON.stringify(name) + ']');\r\n          });\r\n        }\r\n        return nu;\r\n      }\r\n      return value;\r\n    })(object, '$');\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { NgxJsonViewerComponent } from './ngx-json-viewer/ngx-json-viewer.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule\r\n  ],\r\n  declarations: [\r\n    NgxJsonViewerComponent\r\n  ],\r\n  exports: [\r\n    NgxJsonViewerComponent\r\n  ]\r\n})\r\nexport class NgxJsonViewerModule { }\r\n"]}